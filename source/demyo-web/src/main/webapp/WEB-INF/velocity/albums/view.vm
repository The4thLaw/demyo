#setPageTitleParams('title.view.album' $album.title)

$javascript.load('Demyo.Readers')
$javascript.load('Demyo.DragAndDrop')

$quickTasks.add({
	"id" : "qt-fave-album",
	"url" : "$link.contextPath/readers/current/favourites/albums/$album.id",
	"icon": "heart_outline",
	"overflow": false
})
$quickTasks.add({
	"id" : "qt-unfave-album",
	"url" : "$link.contextPath/readers/current/favourites/albums/$album.id",
	"icon": "heart",
	"overflow": false
})
#if (!$album.wishlist)
## Only allow adding albums not in the wishlist. They will be added automatically when acquired
$quickTasks.add({
	"id" : "qt-add-album-to-readingList",
	"url" : "$link.contextPath/readers/current/readingList/albums/$album.id",
	"icon": "bookmark"
})
#end
$quickTasks.add({
	"id" : "qt-edit-album",
	"url" : "../edit/$album.id",
	"icon": "open_book+edit"
})
$quickTasks.add({
	"id" : "qt-delete-album",
	"url" : "../delete/$album.id",
	"icon": "open_book+delete",
	"confirm" : true
})
##TODO: QT to add a derivative to the Album
##TODO: QT to lend album
$quickTasks.add({
	"id" : "qt-add-images-to-album",
	"url" : "#",
	"icon": "camera+add"
})

#if (!$album.wishlist)
## No need to include the button to remove if we cannot add dynamically
#@fabs()
	<a href="$link.contextPath/readers/current/readingList/albums/$album.id" id="fab-remove-readingList" class="dem-fabs__button">
		<button id="fab-remove-readingList-button" class="mdl-button mdl-js-button mdl-button--fab mdl-js-ripple-effect mdl-button--colored dem-main-fab">
			#icon('bookmark+delete')
		</button>
		<div class="mdl-tooltip" for="fab-remove-readingList-button">#_("button.album.removeFromReadingList")</div>
	</a>
#end
#end

#thumbnail($album.cover, {'classes':'model-identification'})

<input type="hidden" id="is_favourite" value="$demyoReaderService.context.isFavouriteAlbum($album)">
<input type="hidden" id="is_readingList" value="$demyoReaderService.context.isAlbumInReadingList($album)">

<div class="mdl-grid dem-field-set" id="album-identification">
	#@mdlGridCell([6,4,4])
		#entityFieldText('field.Album.identifyingName' $album.identifyingName)
	#end
	#@mdlGridCellCond([6,4,4], $album.series)
		#entityFieldLinkedModel('field.Album.series' $album.series)
	#end
	#set ($cond = !($album.tags.empty))
	#@mdlGridCellCond([12,0,0], $cond)
		#entityFieldTagList('field.Album.tags', $album.tags)
	#end
</div>


<div class="mdl-grid dem-field-set">
	#@mdlGridCell([4,0,0])
		#entityFieldLinkedModel('field.Album.publisher' $album.publisher)
	#end
	#@mdlGridCellCond([4,0,0], $album.collection)
		#entityFieldLinkedModel('field.Album.collection' $album.collection)
	#end
	#@mdlGridCellCond([4,0,0], $album.isbn)
		#entityFieldText('field.Album.isbn' $album.isbn)
	#end
</div>


#if (!($album.writers.empty && $album.artists.empty && $album.colorists.empty
		&& $album.inkers.empty && $album.translators.empty))
<div class="mdl-grid dem-field-set">
	#set ($cond = !($album.writers.empty))
	#@mdlGridCellCond([4,0,0], $cond)
		#entityFieldCsvList('field.Album.writers', $album.writers, '/authors/view/')
	#end
	#set ($cond = !($album.artists.empty))
	#@mdlGridCellCond([4,0,0], $cond)
		#entityFieldCsvList('field.Album.artists', $album.artists, '/authors/view/')
	#end
	#set ($cond = !($album.colorists.empty))
	#@mdlGridCellCond([4,0,0], $cond)
		#entityFieldCsvList('field.Album.colorists', $album.colorists, '/authors/view/')
	#end
	#set ($cond = !($album.inkers.empty))
	#@mdlGridCellCond([4,0,0], $cond)
		#entityFieldCsvList('field.Album.inkers', $album.inkers, '/authors/view/')
	#end
	#set ($cond = !($album.translators.empty))
	#@mdlGridCellCond([4,0,0], $cond)
		#entityFieldCsvList('field.Album.translators', $album.translators, '/authors/view/')
	#end
</div>
#end

#if($album.firstEditionDate || $album.currentEditionDate || $album.wishlist || $album.acquisitionDate)
<div class="mdl-grid dem-field-set">
	#if ($album.firstEditionDate && $album.currentEditionDate && $album.firstEditionDate == $album.currentEditionDate)
		#@mdlGridCell([4,0,0])
			#@entityField('field.Album.firstEditionDate')
				$date.format("#_('special.date.format')", $album.firstEditionDate, $appConfig.language)
				#_('field.Album.isFirstEdition')
			#end
		#end
	#elseif ($album.firstEditionDate || $album.currentEditionDate)
		#@mdlGridCell([4,0,0])
			#entityFieldDate('field.Album.firstEditionDate' $album.firstEditionDate)
			#entityFieldDate('field.Album.currentEditionDate' $album.currentEditionDate)
		#end
	#end
	#set ($cond = $album.wishlist || $album.acquisitionDate)
	#@mdlGridCellCond([4,0,0], $cond)
		#if ($album.wishlist)
			#entityFieldBoolean('field.Album.wishlist', $album.wishlist)
		#else
			#entityFieldDate('field.Album.acquisitionDate', $album.acquisitionDate)
		#end
	#end
</div>
#end


<div class="mdl-grid dem-field-set">
	#@mdlGridCellCond([4,0,0], $album.binding)
		#entityFieldLinkedModel('field.Album.binding' $album.binding)
	#end
	#set ($cond = ($album.width || $album.height))
	#@mdlGridCellCond([4,0,0], $cond)
		#if ($album.width && $album.height)
			#entityFieldText('field.Album.size' "#number($album.width) x #number($album.height)")
		#elseif ($album.width)
			#entityFieldNumber('field.Album.width' $album.width)
		#elseif ($album.height)
			#entityFieldNumber('field.Album.height' $album.height)
		#end
	#end
	#@mdlGridCellCond([4,0,0], $album.pages)
		#entityFieldText('field.Album.pages' $album.pages)
	#end
	#@mdlGridCellCond([4,0,0], $album.aggregatedLocation)
		#entityFieldText('field.Album.location' $album.aggregatedLocation)
	#end
</div>


#if ($album.purchasePrice || !$album.prices.empty)
<div class="mdl-grid dem-field-set">
	#@mdlGridCellCond([6,4,0], $album.purchasePrice)
		#entityFieldNumber('field.Album.purchasePrice' $album.purchasePrice)
	#end
	#set ($cond = !($album.prices.empty))
	#@mdlGridCellCond([6,4,0], $cond)
		#@entityField('field.Album.prices.history')
			<table class="mdl-data-table mdl-js-data-table">
				<tr>
					<th class="mdl-data-table__cell--non-numeric">#_('field.Album.prices.date')</th>
					<th>#_('field.Album.prices.price')</th>
				</tr>
				#foreach($price in $album.prices)
					<tr>
						<td class="mdl-data-table__cell--non-numeric">#date($price.date)</td>
						<td>#number($price.price)</td>
					</tr>
				#end
			</table>
		#end
	#end
</div>
#end

#if ($album.summary || $album.comment)
<div class="mdl-grid dem-field-set">
	#@mdlGridCellCond([6,4,0], $album.summary)
		#entityFieldRichText('field.Album.summary', $album.summary)
	#end
	#@mdlGridCellCond([6,4,0], $album.comment)
		#entityFieldRichText('field.Album.comment', $album.comment)
	#end
</div>
#end

## TODO: list of derivatives
